<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Kiosko - Productos</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
</head>
<body class="bg-gray-50 text-gray-800">
  <header class="bg-green-700 text-white py-4 shadow-md">
    <div class="max-w-6xl mx-auto px-4 flex flex-col sm:flex-row items-center justify-between gap-2 text-center sm:text-left">
   
      <!-- Nombre del sitio -->
      <h1 class="text-2xl font-bold tracking-wide flex items-center space-x-2">
        <svg class="w-7 h-7 text-white" fill="currentColor" viewBox="0 0 24 24">
          <path d="M3 9l1-5h16l1 5v2a2 2 0 01-2 2v6a1 1 0 01-1 1h-4a1 1 0 01-1-1v-3H9v3a1 1 0 01-1 1H4a1 1 0 01-1-1v-6a2 2 0 01-2-2V9zM4.618 4L4 8h16l-.618-4H4.618z" />
        </svg>
        <span>Kiosko "El Dinamiko"</span>
      </h1>
      
      <!-- Eslogan o mensaje -->
      <p class="text-sm sm:text-base text-green-100 mx-5">¬°Productos frescos, precios justos, cerca de ti!</p>

      <!-- search productby nombre -->
      <div class="relative max-w-md mx-auto mt-4 sm:mt-0">
        <span class="absolute inset-y-0 left-0 pl-3 flex items-center text-gray-500">
          üîç
        </span>
        <input
          id="buscador"
          type="text"
          placeholder="Buscar producto..."
          class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-green-500 text-black"
        />
      </div>

    <!-- Estado del kiosko (Abierto o Cerrado) -->
    <div id="estadoKiosko" class="font-semibold mt-2 sm:mt-0 px-4 py-2 rounded-lg"></div>

      <!-- search productby nombre -->
    <!-- <div class="relative max-w-md mx-auto mb-6">
      <span class="absolute inset-y-0 left-0 pl-3 flex items-center text-gray-500">
        üîç
      </span>
      <input
        id="buscador"
        type="text"
        placeholder="Buscar producto..."
        class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-green-500"
      />
    </div> -->
  </header>

    
    
  
        <!-- Spinner de carga -->
    <div id="loader" class="flex justify-center items-center my-10">
        <div class="animate-spin rounded-full h-10 w-10 border-t-4 border-green-600 border-opacity-50"></div>
        <span class="ml-3 text-green-600 font-medium">Cargando productos...</span>
    </div>
    <div id="anuncio" class="hidden max-w-3xl mx-auto mt-6 border border-red-300 bg-red-100 text-red-800 rounded-lg px-4 py-4 mb-6 text-center text-sm font-semibold shadow-md"></div>


    <h2 id="tituloProductos" class="text-2xl font-bold text-green-700 text-center mb-4 hidden">Nuestros productos</h2>
    <div id="productos" class="px-4 sm:px-0 grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6"></div>

    <!-- Secci√≥n para mostrar la fecha de actualizaci√≥n general -->
    <p class="text-center text-sm text-gray-500 mt-6" id="fecha-actualizacion"></p>
    </div>

    <!-- mini spinner para carga progresiva de productos -->
    <div id="scroll-loader" class="hidden flex justify-center items-center my-8">
      <div class="animate-spin rounded-full h-6 w-6 border-t-4 border-green-500 border-opacity-50"></div>
      <span class="ml-2 text-green-600 text-sm font-medium">Cargando m√°s...</span>
    </div>
    
    <footer id="footer_id" class="bg-green-700 text-white mt-1 hidden">
      <div class="max-w-6xl mx-auto px-4 py-10 grid grid-cols-1 sm:grid-cols-3 gap-6 text-sm">
        
        <!-- Direcci√≥n -->
        <div class="flex items-start space-x-3">
          <svg class="w-5 h-5 mt-1 flex-shrink-0" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" d="M17.657 16.657L13.414 12.414a4 4 0 10-5.657 5.657l4.243 4.243a1 1 0 001.414 0l4.243-4.243a1 1 0 000-1.414z" />
            <path stroke-linecap="round" stroke-linejoin="round" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
          </svg>
          <div>
            <p class="font-semibold">Direcci√≥n</p>
            <p>Av. Libertad 30, Aguada Pasajeros</p>
          </div>
        </div>
    
        <!-- Tel√©fono -->
        <div class="flex items-start space-x-3">
          <svg class="w-5 h-5 mt-1 flex-shrink-0" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" d="M3 5a2 2 0 012-2h1.6a1 1 0 011 .77l1.2 5a1 1 0 01-.25.92L7 12l3 3 1.3-1.3a1 1 0 01.92-.25l5 1.2a1 1 0 01.77 1V19a2 2 0 01-2 2h-1A16 16 0 013 5z" />
          </svg>
          <div>
            <p class="font-semibold">Tel√©fono</p>
            <p>+53 58786491</p>
          </div>
        </div>
    
        <!-- Horarios -->
        <div class="flex items-start space-x-3">
          <svg class="w-5 h-5 mt-1 flex-shrink-0" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6l4 2m4-2a8 8 0 11-8-8 8 8 0 018 8z" />
          </svg>
          <div>
            <p class="font-semibold">Horario</p>
            <p>Lunes a S√°bado: 8:00 AM ‚Äì 6:00 PM<br>Domingo: 8:00 AM ‚Äì 2:00 PM</p>
          </div>
        </div>
    
      </div>
      <div class="text-center text-xs text-white bg-green-800 py-3">
        ¬© 2025. Todos los derechos reservados.
      </div>
    </footer>
    
  

  <script>
    const baseCSV = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSdGJb4kwwP4q1T67lsBinMWC7zey_K8j3wtLwn8jGqz13Srnd3EmdmtUAO_EbgUCVr3ewFJVv7YG2y/pub?gid=0&single=true&output=csv';
    const urlCSV = `${baseCSV}&cacheBust=${Date.now()}`;
    
    // Mapa de colores permitidos en Tailwind
    const colorMap = {
          Azul: 'bg-blue-500',
          Red: 'bg-red-500',
          Gris: 'bg-gray-500'
    };
 
    let container, productos = [];
    let productosFiltrados = [];
    let currentIndex = 0;
    const pageSize = 1000;

    fetch(urlCSV)
      .then(response => response.text())
      .then(csvText => {
        Papa.parse(csvText, {
          header: true,
          skipEmptyLines: true,
          complete: function(results) {
            document.getElementById('buscador').addEventListener('input', function (e) {
            const valor = e.target.value.toLowerCase().trim();
            productosFiltrados = productos.filter(p =>
              // p.Nombre?.toLowerCase().includes(valor)
              p.Nombre?.toLowerCase().startsWith(valor)
            );

            // Reiniciar lista
            document.getElementById('productos').innerHTML = '';
            currentIndex = 0;

            if (productosFiltrados.length === 0) {
              document.getElementById('productos').innerHTML =
                '<p class="text-center col-span-3 text-green-500">No se encontraron productos.</p>';
            } else {
              loadMoreProducts(); // Mostrar los primeros filtrados
            }
          });

            productos = results.data;
            productosFiltrados = productos; // Inicialmente, no hay filtro
            container = document.getElementById('productos');
            // console.log(productos)
            const obj = productos.find(p => p.Estado?.trim());
            const estado = obj?.Estado;
            // console.log(obj)

            // Mostrar estado
            const estadoDiv = document.getElementById('estadoKiosko');
                estadoDiv.textContent = estado === 'a'
                    ? 'üü¢ ABIERTO'
                    : 'üî¥ CERRADO';
                estadoDiv.className = estado === 'a'
                    // ? 'text-green-600 text-center text-xl font-bold mb-4'
                    // : 'text-red-600 text-center text-xl font-bold mb-4';
                    ? 'bg-green-600 text-white font-bold text-xl px-4 py-2 rounded-lg shadow-lg border-1 border-green-800'
                    : 'bg-green-600 text-white font-bold text-xl px-4 py-2 rounded-lg shadow-lg border-1 border-green-800';

            const anuncioDiv = document.getElementById('anuncio');
            const anuncioTexto = obj.Anuncio?.trim();

            if (anuncioTexto) {
                anuncioDiv.textContent = anuncioTexto;
                anuncioDiv.classList.remove('hidden');
            }

            loadMoreProducts(productos, container); // Carga inicial de 10 productos
                     
            // Mostrar productos y ocultar el spinner
            document.getElementById('loader').style.display = 'none';
            container.classList.remove('hidden');

            // Mostrar la fecha de √∫ltima actualizaci√≥n general (la fecha actual)
            // const fechaActualizacion = new Date().toLocaleDateString(); // Fecha actual
            // Buscar la primera fecha v√°lida de actualizaci√≥n
            // const filaConFecha = productos.find(p => p.FechaActualizacion?.trim());
            const fechaActualizacion = obj?.FechaActualizacion || 'desconocida';
            document.getElementById('fecha-actualizacion').textContent = `√öltima actualizaci√≥n: ${fechaActualizacion}`;
          }
        });
      })
      .catch(error => console.error('Error al obtener el CSV:', error));

      window.addEventListener('scroll', () => {
        const { scrollTop, scrollHeight, clientHeight } = document.documentElement;

        if (scrollTop + clientHeight >= scrollHeight - 5) {
          if (currentIndex < productos.length) {
            loadMoreProducts();
          }
        }
      });


  function loadMoreProducts() {
      // Mostrar los productos en el contenedor
      const scrollLoader = document.getElementById('scroll-loader');
      scrollLoader.classList.remove('hidden');

      document.getElementById('tituloProductos').classList.remove('hidden'); 
      document.getElementById('footer_id').classList.remove('hidden');

      // setTimeout(() => {}, 6000);
      const product_slice = productosFiltrados.slice(currentIndex, currentIndex + pageSize);
      product_slice.forEach(prod => {
                
                const card = document.createElement('div');
                // card.className = 'bg-white rounded-2xl shadow p-4 border border-gray-200';
                card.className = 'relative bg-white rounded-2xl shadow p-4 border border-gray-200';


                
                // Si no hay imagen, usar un icono por defecto local
                const imageSrc = prod.Imagen ? prod.Imagen : 'fotos/no_imagen.jpg'; // Ruta relativa a la imagen de fallback

                // Crear la imagen con el manejador de error para mostrar el icono si no se carga
                const imageElement = document.createElement('img');
                imageElement.src = imageSrc;
                imageElement.alt = prod.Nombre;
                imageElement.className = 'h-60 w-full object-cover rounded-md mb-3';

                // Agregar etiqueta si existe en el CSV
                // Color de fondo din√°mico desde la hoja de c√°lculo
                const colorClase = colorMap[prod.Color?.trim()] || 'bg-gray-500'
                if (prod.Etiqueta?.trim()) {
                    const etiqueta = document.createElement('span');
                    etiqueta.textContent = prod.Etiqueta;
                    // etiqueta.className = 'absolute top-2 left-2 bg-blue-500 text-white text-xs font-semibold px-2 py-1 rounded-full shadow';
                    // etiqueta.className = 'absolute top-2 right-2 bg-red-500 text-white text-xs font-semibold px-2 py-1 rounded-full shadow';
                    etiqueta.className = `absolute top-2 right-2 ${colorClase} text-white text-sm font-semibold px-3 py-1.5 rounded-full shadow`;
                    
                    card.appendChild(etiqueta);
                }
                card.appendChild(imageElement);

                card.innerHTML += `
                    <h2 class="text-xl font-semibold text-green-800">${prod.Nombre}</h2>
                    <p class="text-gray-600 text-sm mb-2">${prod.Descripcion}</p>
                    <p class="text-lg font-bold text-green-600">$${prod.Precio}</p>
                `;
                container.appendChild(card);
            });

      currentIndex += pageSize;
      scrollLoader.classList.add('hidden');
    }

  </script>
</body>
</html>



<!-- fotos/malta_bucanero.webp -->
<!-- Promo 2x1 a partir de las 2 PM -->